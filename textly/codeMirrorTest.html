<script type="text/javascript" src="lib/codemirror.js"></script>
<!-- 
<script type="text/javascript" src="lib/acorn.js"></script>
<script type="text/javascript" src="lib/acorn-walker.js"></script>
 -->
<script type="text/javascript" src="lib/esprima.js"></script>
<script type="text/javascript" src="lib/escodegen.browser.js"></script>
<script type="text/javascript"  src="lib/codemirror-js-mode.js"></script>
<script type="text/javascript"  src="lib/codemirror-turtle-mode.js"></script>
<link rel="stylesheet" type="text/css" href="lib/codemirror.css">

Code Mirror Testing:
<div id="codeMirrorWrapper" style="width:50%;border:1px solid;">
  <textarea id="codeMirror-textArea">moveForward(11);
var x = 10;
if (x < 11){
  moveBackward(10);
}
forward(12);</textarea>
</div>

<br/>
<button onclick="compile_cm()">Run-CM-parser</button>
<button onclick="compile_acorn()">Run-acorn-parser</button>
<button onclick="compile_esprima()">Run-esprima-parser</button>
<br/><br/>
Output: <br/>
<div id="output" style="border:1px solid;width:50%;padding:4px;">
  <br/>
</div>

<style type="text/css">


</style>

<script>

  var myCodeMirror;

  function init() {
    var cmTextArea = document.getElementById('codeMirror-textArea');
    myCodeMirror = CodeMirror.fromTextArea(cmTextArea, 
      {
        mode: "turtle",
        lineNumbers: true,
        tabSize: 2
      });
  }

  window.addEventListener('load', init);

  function compile_cm() {
    var codeMirrorText = myCodeMirror.getValue();

    // magic

    var output = document.getElementById('output');
    myCodeMirror.eachLine( function(line) {
      var outText = myCodeMirror.getMode().turtleToJS(line.text);
      output.appendChild(document.createTextNode(outText));
      console.log(line);
    });

    // document.getElementById('output').innerHTML = codeMirrorText;
  }

  function compile_acorn() {
    var codeMirrorText = myCodeMirror.getValue();
    var tokener = acorn.tokenize(codeMirrorText);
    var blah;
    while (blah = tokener()) {
      console.log(blah)
    }



  // walk.simple(acorn.parse(codeMirrorText), {
  //   Expression: function(node) { 
  //     if (node.type == "Identifier") {
  //       console.log(node.name);
  //     } else {
  //       console.log(node.value) 
  //     }
  //   }
  // });

    // document.getElementById('output').innerHTML = codeMirrorText;
  }

  var TurtleLanguage = {
    'moveForward' : { js : 'Turtle.moveForward'}
  };
  

  function compile_esprima() {
    var codeMirrorText = myCodeMirror.getValue();

    var turtleCode = "", token;

    var parsed = esprima.parse(codeMirrorText, {'tokens': true});
    for (i = 0; i < parsed.tokens.length; i++) {
        token = parsed.tokens[i].value;
        if (TurtleLanguage[token]) {
          turtleCode += TurtleLanguage[token].js
        } else {
          turtleCode += token;
        }
    }

    turtleCode = escodegen.generate(esprima.parse(codeMirrorText), {identifierRewriteVisitor: function(generated) {
      if (generated == "moveForward") {
        return "Turtle.moveForward";
      } else {
        return generated;
      }
     }});

    document.getElementById('output').innerHTML = turtleCode;
  }
   


</script>